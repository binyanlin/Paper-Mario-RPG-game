<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>RPG Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
    <link rel="stylesheet" href="./assets/css/style.css"/>
</head>
<body class="text-light">

    <div class="title">
        <img class="mx-auto" src="./assets/images/title2.png"/>
    </div>

    <div class="startingArea">
        <div class="row">
            <button type="button" class="char char1 col-sm btn text-light" id="A">
                    <img src="./assets/images/goomba.png"/>
                    <p>HP: <span class="charHp" >90</span></p>
            </button>
            <button type="button" class="char char2 col-sm btn text-light" id="B">
                    <img src="./assets/images/bob-omb.png"/>
                    <p>HP: <span class="charHp">60</span></p>
            </button>
            <button type="button" class="char char3 col-sm btn text-light" id="C">
                    <img src="./assets/images/paratroopa.png"/>
                    <p>HP: <span class="charHp">120</span></p>
            </button>    
            <button type="button" class="char char4 col-sm btn text-light" id="D">
                    <img src="./assets/images/spiny2.png"/>
                    <p>HP: <span class="charHp">75</span></p>
            </button>
        </div>
    </div>

    <!-- for you win, select your character, etc  -->
    <div><h1 class="comment text-center">Select Character to Start!</h1></div>

    
    <div class="row">
        <div class="col-sm ml-3">
            <h2 class="text-center">Your Character</h2>
            <div class="yourCharacter bg-success rounded-circle"></div>
        </div>
        <div class="col-sm">
            <h2 class="text-center">Defender</h2>
            <div class="defender bg-danger rounded-circle"></div>
        </div>
        <div class="col-sm">
            <h2 class="text-center">Enemies Left</h2>
            <div class="enemyField bg-warning rounded-circle"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-1"></div>
        <div class="col-sm-1 attackButtonPlace"></div>
        <div class="col-sm-6 text-center attackLogPlace"></div>
        <div class="col-sm-2 spacer"></div>
        <div class="col-sm-1 retryButtonPlace"></div>
        <div class="col-sm-1"></div>
    </div>

    <script>
    //variables

    //hp of the 4 characters
    let hpA = 90;
    let hpB = 60;
    let hpC = 120;
    let hpD = 75;

    let playerHp;
    let enemyHP;
    let enemyKillCount = 0;

    //attackButton
    var attackButton = `<button type="button" class="text-light rounded-circle attackB"><h5>Attack!</h5></button>`

    //retryButton
    var retryButton = `<button type="button" class="text-light rounded-circle retryB"><h5>Retry</h5></button>`

    charPick = false;
    enemyPick = false;
    let attackGrowth;
    let baseAttackPower;
    let counterAttack;
    let attackCounter = 0;

    // each turn:                     
    let baseAttackPowerList = {A: 8, B: 14, C: 2, D: 6};
    let attackGrowthList = {A: 6, B: 14, C: 4, D: 10};
    let counterAttackList = {A: 15, B: 20, C: 15, D: 18};
    // object of objects:
    let charData = {baseAttackPowerList, attackGrowthList, counterAttackList}

    const damageAssigner = function() {
        if (playerId == "A") {
            baseAttackPower = baseAttackPowerList.A;
            attackGrowth = attackGrowthList.A;
        } else if (playerId == "B") {
            baseAttackPower = baseAttackPowerList.B;
            attackGrowth = attackGrowthList.B;  
        } else if (playerId == "C") {
            baseAttackPower = baseAttackPowerList.C;
            attackGrowth = attackGrowthList.C;
        } else if (playerId == "D") {
            baseAttackPower = baseAttackPowerList.D;
            attackGrowth = attackGrowthList.D;
        };

        if (enemyId == "A") {
            counterAttack = counterAttackList.A;
        } else if (enemyId == "B") {
            counterAttack = counterAttackList.B;
        } else if (enemyId == "C") {
            counterAttack = counterAttackList.C;
        } else if (enemyId == "D") {
            counterAttack = counterAttackList.D;
        };
        // console.log("baseAttackPower: ", baseAttackPower, "attackGrowth: ", attackGrowth, "counterAttack: ", counterAttack);
    };
    // gamestart


    // onclick function for char selections
    $(".char").on("click", function() {
        // if no character in "your character" division
        if (charPick === false && enemyPick === false) {
            $(this).removeClass("char").addClass("mainChar");
        // moves chosen char to main char, moves others to enemy char
            $(".yourCharacter").append($(this));
            $(".enemyField").append($(".char"));
        // assign HP to playerHp, assign stats from object
            $(this).removeClass("charHp").addClass("playerHp");
            playerHp = $(".playerHp").text();
            playerHp = parseInt(playerHp.replace(/[^\d]/g, ''));
            playerId = $(this).attr("id");
        // display next step
            $(".comment").text("Select your first opponent")
            charPick = true;
        // moves enemy to defender and assigns enemyHp
        } else if (charPick === true && enemyPick === false && $(this).hasClass("char")) {  //note: last "and" is to remove edge case of putting main character into defender category
            $(this).removeClass("char").addClass("currentEnemy");
            $(".defender").append($(".currentEnemy"));
        // assign defender's hp as enemyHP
            $(this).removeClass("charHp").addClass("enemyHp");
            enemyHp = $(".enemyHp").text();
            enemyHp = parseInt(enemyHp.replace(/[^\d]/g, ''));
            enemyId = $(this).attr("id");
        // allows for attack to begin
            $(".comment").text("Begin Fight!");
            damageAssigner();
            enemyPick = true;
            $(".attackButtonPlace").html(attackButton);
        };
    }); 


    const enemyHpCheck = function() {
        if (enemyHp > 0) {
            $(".enemyHp").find(".charHp").text(enemyHp);
            playerHp -= counterAttack;
            $(".attackLogPlace").append(`<p>Defender deals ${counterAttack} damage.</p>`);
        } else if (enemyHp <= 0) {
            $(".enemyHp").find(".charHp").text("0");
            $(".comment").text("Enemy fainted!")
            $(".attackLogPlace").append(`<p>Defender fainted!</p>`);
            enemyKillCount++;
            setTimeout(function() { 
                $(".enemyHp").remove();
                $("attackB").remove();
            }, 2000);
            gameEnd();
        };
    };

    const gameEnd = function() {
        if (enemyKillCount < 3) {
            setTimeout(function() { 
                $(".comment").text("Select New Opponent");
                enemyPick = false;
                $(".attackLogPlace").text("Select New Opponent");
            }, 3000);
        } else if (enemyKillCount >= 3) {
            setTimeout(function() { 
                $(".comment").text("You Win!");
                enemyPick = false;
                $(".attackLogPlace").text("You defeated everyone! Congrats!");
            }, 3000);
            $(".retryButtonPlace").html(retryButton);
        };
    };

    const playerHpCheck = function() {
        if (playerHp > 0) {
            $(".playerHp").find(".charHp").text(playerHp);
        } else if (playerHp <= 0) {
            $(".playerHp").find(".charHp").text("0");
            setTimeout(function() { 
                $(".comment").text("You Lose!");
                $(".attackLogPlace").text("You Lost!");
            }, 2000);
            setTimeout(function() { 
                $(".attackLogPlace").append("<p>Press the Retry Button to try again<p>");
                $(".retryButtonPlace").html(retryButton);
            }, 3000);
            
        };
    };

    // Attack button action sequence 
    $(document).on("click", ".attackB", function() {
        let attackDamage = baseAttackPower + attackCounter*attackGrowth;
        if (enemyHp > 0) {
            enemyHp -= attackDamage;
            $(".attackLogPlace").text("You deal " + attackDamage + " damage! ");
            enemyHpCheck();
            attackCounter++;
            playerHpCheck();
        };
    });
    
    // Retry Button
    // $(document).on("click", ".retryButton", function() {
        // 
        // 
        // 
        // 
        // 
    

    
    
    
    
    </script>


</body>
</html>